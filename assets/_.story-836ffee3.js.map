{"version":3,"file":"_.story-836ffee3.js","sources":["../../src/hook/useInertia.ts","../../src/components/gesture/Inertia/Inertia.tsx","../../src/components/gesture/Inertia/_.story.tsx"],"sourcesContent":["import { useCallback } from 'react'\r\n\r\nimport {\r\n  useSpring,\r\n  SpringValues,\r\n  SpringRef,\r\n  SpringConfig,\r\n  UseSpringProps,\r\n} from '@react-spring/web'\r\n\r\nexport interface InertialConfig<T extends {}> extends SpringConfig {\r\n  inertia: true\r\n  bounds: Record<keyof T, [number, number]>\r\n  velocities: Record<keyof T, number>\r\n  decay?: boolean\r\n}\r\n\r\nexport interface NoninertialConfig extends SpringConfig {\r\n  inertia?: false\r\n  decay?: boolean\r\n}\r\n\r\ntype IConfig<T extends {}> = InertialConfig<T> | NoninertialConfig\r\n\r\nexport type UseInertia<T extends {}> = [\r\n  SpringValues<T>,\r\n  SpringRef<T & { config: IConfig<T> }>['set']\r\n]\r\n\r\nexport const useInertia = <T extends Record<string, any>>(\r\n  initialProps: UseSpringProps<T & { config: IConfig<T> }>\r\n): UseInertia<T> => {\r\n  const [props, spring] = useSpring(() => initialProps)\r\n\r\n  const setInertia = useCallback<SpringRef<T & { config: IConfig<T> }>['set']>(\r\n    ({ config = {}, ...to }) => {\r\n      const { inertia, bounds, velocities, ...rest }: any = config\r\n\r\n      if (!inertia) {\r\n        spring.start({ ...to, config: rest })\r\n        return\r\n      }\r\n\r\n      spring.start({\r\n        ...to,\r\n        onChange: (values) => {\r\n          Object.entries(values.value as any).forEach(([key, v]: any) => {\r\n            const vel = (props as any)[key].velocity\r\n            const bound =\r\n              v >= bounds[key][1]\r\n                ? bounds[key][1]\r\n                : v <= bounds[key][0]\r\n                ? bounds[key][0]\r\n                : undefined\r\n\r\n            if (bound !== undefined) {\r\n              ;(props as any)[key].stop()\r\n              spring.start({\r\n                [key]: bound,\r\n                config: { decay: false, velocity: vel } as any,\r\n              })\r\n            }\r\n          })\r\n        },\r\n        config: (k: string) => ({\r\n          decay: true,\r\n          velocity: velocities && velocities[k],\r\n        }),\r\n      })\r\n    },\r\n    [props, spring]\r\n  )\r\n\r\n  return [props, setInertia] as UseInertia<T>\r\n}\r\n","import { useEffect } from 'react'\r\nimport useMeasure from 'react-use-measure'\r\n\r\nimport { animated, config } from '@react-spring/web'\r\nimport { useGesture } from '@use-gesture/react'\r\n\r\nimport { useInertia } from '~/hook/useInertia'\r\n\r\nimport classes from './_classes.css'\r\n\r\nconst imgs = [\r\n  'https://images.pexels.com/photos/62689/pexels-photo-62689.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=750',\r\n  'https://images.pexels.com/photos/296878/pexels-photo-296878.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=750',\r\n  'https://images.pexels.com/photos/1509428/pexels-photo-1509428.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=750',\r\n  'https://images.pexels.com/photos/351265/pexels-photo-351265.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=750',\r\n  'https://images.pexels.com/photos/924675/pexels-photo-924675.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=750',\r\n]\r\n\r\nexport const Inertia = () => {\r\n  const [{ y }, set] = useInertia<{ y: number }>({ y: 0 })\r\n\r\n  const [ref, { height }] = useMeasure()\r\n  const wHeight = window.innerHeight\r\n\r\n  const bind = useGesture(\r\n    {\r\n      onDrag: ({\r\n        down,\r\n        offset: [, my],\r\n        velocity: [, vy],\r\n        direction: [, dy],\r\n      }) => {\r\n        if (down) {\r\n          set({ y: my, config: { decay: false, velocity: 0 } })\r\n        } else {\r\n          set({\r\n            y: my,\r\n            config: {\r\n              inertia: true,\r\n              bounds: { y: [-height + wHeight, 0] },\r\n              velocities: { y: vy * dy },\r\n            },\r\n          })\r\n        }\r\n      },\r\n      onWheel: ({ delta: [, dy] }) => {\r\n        set({\r\n          y: Math.max(-height + wHeight, Math.min(y.get() - dy * 3, 0)),\r\n          config: config.stiff,\r\n        })\r\n      },\r\n    },\r\n    {\r\n      drag: {\r\n        from: () => [0, y.get()],\r\n        bounds: { top: -height + wHeight, bottom: 0 },\r\n        rubberband: true,\r\n      },\r\n    }\r\n  )\r\n\r\n  useEffect(() => {\r\n    window.document.body.style.overflow = 'hidden'\r\n\r\n    return () => {\r\n      window.document.body.style.overflow = ''\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    <animated.div\r\n      ref={ref}\r\n      className={classes.wrapper}\r\n      {...bind()}\r\n      style={{ y }}\r\n    >\r\n      {imgs.map((img, i) => (\r\n        <div\r\n          key={i}\r\n          style={{ backgroundImage: `url(${img})` }}\r\n          className={classes.box}\r\n        />\r\n      ))}\r\n    </animated.div>\r\n  )\r\n}\r\n","import { withCenteredStyle } from '~/_storybook/withCenteredStyle';\nimport { withCustomTheme } from '~/_storybook/withCustomTheme';\nimport { withTopLabel } from '~/_storybook/withTopLabel';\nimport { storyLink } from '~/theme/theme.css';\nimport { Inertia } from './Inertia';\nconst label = <>\r\n    <span>Thx to </span>\r\n    <a className={storyLink} href='https://github.com/react-spring/react-use-gesture/issues/132'>\r\n      demonstration\r\n    </a>\r\n  </>;\nexport default {\n  title: 'Gesture/Inertia',\n  decorators: [withCenteredStyle({\n    width: '100%'\n  }), withCustomTheme, withTopLabel(label)]\n};\nexport const _Inertia = () => <Inertia />;\n_Inertia.parameters = {\n  ..._Inertia.parameters,\n  storySource: {\n    source: \"() => <Inertia />\",\n    ..._Inertia.parameters?.storySource\n  }\n};"],"names":["useInertia","initialProps","props","spring","useSpring","setInertia","useCallback","config","to","inertia","bounds","velocities","rest","values","key","v","vel","bound","k","imgs","Inertia","y","set","ref","height","useMeasure","wHeight","bind","useGesture","down","my","vy","dy","useEffect","jsx","animated","classes","img","i","label","jsxs","Fragment","storyLink","__story","withCenteredStyle","withCustomTheme","withTopLabel","_Inertia","_a"],"mappings":"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"}