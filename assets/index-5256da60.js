import{r as e}from"./index-f1f749bf.js";import{u as k,a as v}from"./use-force-update-1df41dbe.js";import{u as $,P as U,L as A,a as F,b as K}from"./motion-c178da69.js";class O extends e.Component{getSnapshotBeforeUpdate(i){const t=this.props.childRef.current;if(t&&i.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function b({children:o,isPresent:i}){const t=e.useId(),r=e.useRef(null),m=e.useRef({width:0,height:0,top:0,left:0});return e.useInsertionEffect(()=>{const{width:f,height:u,top:c,left:h}=m.current;if(i||!r.current||!f||!u)return;r.current.dataset.motionPopId=t;const l=document.createElement("style");return document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${u}px !important;
            top: ${c}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[i]),e.createElement(O,{isPresent:i,childRef:r,sizeRef:m},e.cloneElement(o,{ref:r}))}const g=({children:o,initial:i,isPresent:t,onExitComplete:r,custom:m,presenceAffectsLayout:f,mode:u})=>{const c=$(G),h=e.useId(),l=e.useMemo(()=>({id:h,initial:i,isPresent:t,custom:m,onExitComplete:a=>{c.set(a,!0);for(const s of c.values())if(!s)return;r&&r()},register:a=>(c.set(a,!1),()=>c.delete(a))}),f?void 0:[t]);return e.useMemo(()=>{c.forEach((a,s)=>c.set(s,!1))},[t]),e.useEffect(()=>{!t&&!c.size&&r&&r()},[t]),u==="popLayout"&&(o=e.createElement(b,{isPresent:t},o)),e.createElement(U.Provider,{value:l},o)};function G(){return new Map}const E=o=>o.key||"";function S(o,i){o.forEach(t=>{const r=E(t);i.set(r,t)})}function T(o){const i=[];return e.Children.forEach(o,t=>{e.isValidElement(t)&&i.push(t)}),i}const V=({children:o,custom:i,initial:t=!0,onExitComplete:r,exitBeforeEnter:m,presenceAffectsLayout:f=!0,mode:u="sync"})=>{m&&(u="wait");let[c]=k();const h=e.useContext(A).forceRender;h&&(c=h);const l=v(),a=T(o);let s=a;const p=new Set,x=e.useRef(s),C=e.useRef(new Map).current,y=e.useRef(!0);if(F(()=>{y.current=!1,S(a,C),x.current=s}),K(()=>{y.current=!0,C.clear(),p.clear()}),y.current)return e.createElement(e.Fragment,null,s.map(n=>e.createElement(g,{key:E(n),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:f,mode:u},n)));s=[...s];const R=x.current.map(E),w=a.map(E),I=R.length;for(let n=0;n<I;n++){const d=R[n];w.indexOf(d)===-1&&p.add(d)}return u==="wait"&&p.size&&(s=[]),p.forEach(n=>{if(w.indexOf(n)!==-1)return;const d=C.get(n);if(!d)return;const P=R.indexOf(n),z=()=>{C.delete(n),p.delete(n);const L=x.current.findIndex(M=>M.key===n);if(x.current.splice(L,1),!p.size){if(x.current=a,l.current===!1)return;c(),r&&r()}};s.splice(P,0,e.createElement(g,{key:E(d),isPresent:!1,onExitComplete:z,custom:i,presenceAffectsLayout:f,mode:u},d))}),s=s.map(n=>{const d=n.key;return p.has(d)?n:e.createElement(g,{key:E(n),isPresent:!0,presenceAffectsLayout:f,mode:u},n)}),e.createElement(e.Fragment,null,p.size?s:s.map(n=>e.cloneElement(n)))};export{V as A};
//# sourceMappingURL=index-5256da60.js.map
