{"version":3,"file":"_.story-0fb444ee.js","sources":["../../src/components/gesture/Hero/Hero.tsx","../../src/components/gesture/Hero/_.story.tsx"],"sourcesContent":["import { useState, useRef, useLayoutEffect } from 'react'\r\n\r\nimport {\r\n  useSpring,\r\n  animated,\r\n  useTransition,\r\n  useChain,\r\n  useSpringRef,\r\n} from '@react-spring/web'\r\nimport { useGesture } from '@use-gesture/react'\r\n\r\nimport classes from './_classes.css'\r\n\r\nconst trans = (...p: number[]) => `translate3d(${p[0]}px, ${p[1]}px, 0)`\r\n\r\nconst initial = {\r\n  top: 0,\r\n  bottom: 0,\r\n  left: 0,\r\n  right: 0,\r\n  borderRadius: 16,\r\n}\r\n\r\nconst items = Array.from({ length: 5 }).map((_, i) => i)\r\n\r\nexport const Hero = () => {\r\n  const [isOpen, setIsOpen] = useState(false)\r\n  const openRef = useRef(false)\r\n\r\n  const setOpen = (value: boolean) => {\r\n    openRef.current = value\r\n    setIsOpen(value)\r\n  }\r\n\r\n  const ref = useRef<HTMLDivElement>(null)\r\n\r\n  const [{ xy }, spring] = useSpring(() => ({ xy: [0, 0] }))\r\n\r\n  const [vals, setVals] = useState(() => ({ ...initial }))\r\n\r\n  const innerRef = useSpringRef()\r\n\r\n  const inner = useSpring({\r\n    ref: innerRef,\r\n    ...(isOpen ? vals : initial),\r\n    onStart: () => {\r\n      if (openRef.current) {\r\n        document.body.style.overflow = 'hidden'\r\n      }\r\n    },\r\n    onRest: () => {\r\n      if (!openRef.current) {\r\n        document.body.style.overflow = ''\r\n      }\r\n    },\r\n  })\r\n\r\n  useLayoutEffect(() => {\r\n    if (isOpen) {\r\n      const bounds = ref.current?.getBoundingClientRect()\r\n      if (bounds) {\r\n        const { top, bottom, right, left } = bounds\r\n\r\n        setVals({\r\n          top: -top - 5,\r\n          bottom: bottom - window.innerHeight - 5,\r\n          right: right - window.innerWidth - 5,\r\n          left: -left - 5,\r\n          borderRadius: 0,\r\n        })\r\n      }\r\n    } else {\r\n      setVals({ ...initial })\r\n    }\r\n  }, [isOpen])\r\n\r\n  const bind = useGesture(\r\n    {\r\n      onClick: () => setOpen(true),\r\n      onDoubleClick: () => setOpen(false),\r\n      onDrag: ({ offset: [x, y], cancel }) => {\r\n        // If closed - then can move, otherwive cancel drag\r\n        !isOpen ? spring.start({ xy: [x, y] }) : cancel && cancel()\r\n      },\r\n    },\r\n    { drag: { filterTaps: true } }\r\n  )\r\n\r\n  const contentRef = useSpringRef()\r\n  const transition = useTransition(isOpen, {\r\n    from: { opacity: 0, height: 0 },\r\n    enter: { opacity: 1, height: 200 },\r\n    leave: { opacity: 0, height: 0 },\r\n    ref: contentRef,\r\n  })\r\n\r\n  const trailRef = useSpringRef()\r\n  const trail = useTransition(isOpen ? items : [], {\r\n    from: { opacity: 0, x: '100%' },\r\n    enter: { opacity: 1, x: '0%' },\r\n    leave: { opacity: 0, x: '100%' },\r\n    ref: trailRef,\r\n    config: { friction: 20 },\r\n    trail: 100,\r\n  })\r\n\r\n  useChain(\r\n    isOpen\r\n      ? [innerRef, contentRef, trailRef]\r\n      : [trailRef, contentRef, innerRef],\r\n    isOpen ? [0, 0.4, 0.8] : [0, 0.4, 0.8]\r\n  )\r\n\r\n  const renderItems = () =>\r\n    trail((props, _, __, key) => (\r\n      <animated.div\r\n        key={key}\r\n        style={{ ...props, marginBottom: 10, height: 20, background: 'black' }}\r\n      />\r\n    ))\r\n\r\n  const renderContent = () =>\r\n    transition(\r\n      (props, item, _, key) =>\r\n        item && (\r\n          <animated.div key={key} style={props} className={classes.content}>\r\n            <div style={{ height: 200, background: 'red' }}>\r\n              {renderItems()}\r\n            </div>\r\n          </animated.div>\r\n        )\r\n    )\r\n\r\n  return (\r\n    <animated.div\r\n      className={classes.box}\r\n      {...bind()}\r\n      ref={ref}\r\n      style={{ transform: xy.to(trans), touchAction: 'none' }}\r\n    >\r\n      <animated.div\r\n        className={classes.inner}\r\n        onDoubleClick={() => setOpen(false)}\r\n        style={{\r\n          ...inner,\r\n          position: isOpen ? 'fixed' : 'absolute',\r\n        }}\r\n      >\r\n        <span role='img' aria-label='test'>\r\n          üèÜ\r\n        </span>\r\n        {renderContent()}\r\n      </animated.div>\r\n    </animated.div>\r\n  )\r\n}\r\n","import React from 'react';\nimport { withCenteredStyle } from '~/_storybook/withCenteredStyle';\nimport { withCustomTheme } from '~/_storybook/withCustomTheme';\nimport { withTopLabel } from '~/_storybook/withTopLabel';\nimport { Hero } from './Hero';\nconst label = <span>Click to expand, double-click to shrink</span>;\nexport default {\n  title: 'Gesture/Hero',\n  decorators: [withCenteredStyle({\n    width: '100%'\n  }), withCustomTheme, withTopLabel(label)]\n};\nexport const _Hero = () => <Hero />;\n_Hero.parameters = {\n  ..._Hero.parameters,\n  storySource: {\n    source: \"() => <Hero />\",\n    ..._Hero.parameters?.storySource\n  }\n};"],"names":["trans","p","initial","items","_","i","Hero","isOpen","setIsOpen","useState","openRef","useRef","setOpen","value","ref","xy","spring","useSpring","vals","setVals","innerRef","useSpringRef","inner","useLayoutEffect","bounds","_a","top","bottom","right","left","bind","useGesture","x","y","cancel","contentRef","transition","useTransition","trailRef","trail","useChain","renderItems","props","__","key","jsx","animated","renderContent","item","classes","jsxs","label","__story","withCenteredStyle","withCustomTheme","withTopLabel","_Hero"],"mappings":"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"}